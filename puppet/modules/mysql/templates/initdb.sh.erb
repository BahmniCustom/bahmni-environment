#!/bin/sh
set -e -x

sudo service mysql stop
sudo sh mysqld_safe --init-file=/tmp/changepassword.sql &
sudo sh mysqld_safe --init-file=/tmp/grantAccess.sql &

# Assuming that mysql will start within the given time. Possible failure point
sleep 10

sudo mysqladmin -uroot -p$1 shutdown
sudo service mysql start
sudo rm -f /root/.mysql_secret
sudo rm -f /tmp/changepassword.sql
sudo rm -f /tmp/grantAccess.sql